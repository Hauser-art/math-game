<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å°å°æ•¸å­¸å®¶ï¼ˆé¡Œåº«å‡ç´šç‰ˆï¼‰</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: system-ui, -apple-system; background:#f0f9ff; }
.hidden { display:none; }
.btn { background:#3b82f6; color:#fff; border-radius:16px; }
.btn:active { transform:scale(.95); }
</style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

<div class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-md">

<!-- é–‹å§‹ç•«é¢ -->
<div id="start">
  <h1 class="text-2xl font-bold text-center text-blue-600 mb-4">æ•¸å­¸æŒ‘æˆ°</h1>

  <label class="block mb-4">
    <span class="font-bold">é¸æ“‡é›£åº¦ï¼š</span>
    <select id="level" class="w-full border rounded p-2 mt-1">
      <option value="easy">ç°¡å–®</option>
      <option value="normal">æ™®é€š</option>
    </select>
  </label>

  <button class="btn w-full py-3 text-xl" onclick="startGame()">é–‹å§‹</button>
</div>

<!-- éŠæˆ²ç•«é¢ -->
<div id="game" class="hidden text-center">
  <div class="flex justify-between mb-2 text-sm">
    <span>ç¬¬ <span id="qno">1</span>/20 é¡Œ</span>
    <span id="time">15s</span>
    <span>åˆ†æ•¸ <span id="score">0</span></span>
  </div>

  <div id="math" class="hidden">
    <div id="mathQ" class="text-5xl font-bold my-6"></div>
    <input id="mathA" type="number" class="border-b-4 text-4xl w-40 text-center">
  </div>

  <div id="clock" class="hidden">
    <canvas id="clockCanvas" width="200" height="200"></canvas>
    <div class="mt-2">
      <input id="h" type="number" class="border w-20 text-2xl text-center"> :
      <input id="m" type="number" class="border w-20 text-2xl text-center">
    </div>
  </div>

  <button class="btn w-full py-3 mt-4" onclick="check()">é€å‡º</button>
</div>

<!-- çµæœ -->
<div id="result" class="hidden text-center">
  <h2 class="text-2xl font-bold mb-4">å®Œæˆï¼</h2>
  <div class="text-5xl text-blue-600 mb-4" id="final"></div>
  <ul id="wrong" class="text-left text-sm"></ul>
  <button class="btn w-full py-3 mt-4" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
</div>

</div>

<script>
/* ===== å·¥å…· ===== */
const rand=(a,b)=>Array.isArray(a)?a[Math.floor(Math.random()*a.length)]:Math.floor(Math.random()*(b-a+1))+a;

/* ===== é¡Œåº« ===== */
const bank={
easy:{
 math:()=>{let a=rand(2,5),b=rand(2,5);return{t:'math',q:`${a}Ã—${b}`,a:a*b};},
 clock:()=>{let h=rand(1,12),m=rand([0,30]);return{t:'clock',h,m,a:`${h}:${m.toString().padStart(2,'0')}`};}
},
normal:{
 math:()=>{let a=rand(2,9),b=rand(2,9);return{t:'math',q:`${a}Ã—${b}`,a:a*b};},
 clock:()=>{let h=rand(1,12),m=rand([0,5,10,15,20,25,30,35,40,45,50,55]);return{t:'clock',h,m,a:`${h}:${m.toString().padStart(2,'0')}`};}
}
};

let qs=[],i=0,score=0,time,timer,used=new Set(),wrongs=[];

/* ===== éŠæˆ² ===== */
function startGame(){
  let lv=document.getElementById('level').value;
  used.clear(); qs=[]; wrongs=[]; score=0; i=0;
  while(qs.length<20){
    let type=qs.length<10?'math':'clock';
    let q=bank[lv][type]();
    let key=q.q||q.a;
    if(!used.has(key)){ used.add(key); qs.push(q); }
  }
  document.getElementById('start').classList.add('hidden');
  document.getElementById('game').classList.remove('hidden');
  load();
}

function load(){
  let q=qs[i]; time=15;
  document.getElementById('qno').innerText=i+1;
  document.getElementById('score').innerText=score;
  document.getElementById('math').classList.add('hidden');
  document.getElementById('clock').classList.add('hidden');

  if(q.t==='math'){
    document.getElementById('math').classList.remove('hidden');
    document.getElementById('mathQ').innerText=q.q;
    document.getElementById('mathA').value='';
  }else{
    document.getElementById('clock').classList.remove('hidden');
    draw(q.h,q.m);
    h.value=''; m.value='';
  }
  clearInterval(timer);
  timer=setInterval(()=>{
    time--; document.getElementById('time').innerText=time+'s';
    if(time<=0) check(true);
  },1000);
}

function check(timeout=false){
  clearInterval(timer);
  let q=qs[i],ok=false,u='';
  if(!timeout){
    if(q.t==='math'){u=mathA.value; ok=parseInt(u)==q.a;}
    else{u=`${h.value}:${m.value}`; ok=parseInt(h.value)==q.h && parseInt(m.value)==q.m;}
  }
  if(ok) score+=10;
  else wrongs.push(`${q.q||'æ™‚é˜'} â†’ æ­£è§£ ${q.a}`);
  i++;
  i<20?load():end();
}

function end(){
  document.getElementById('game').classList.add('hidden');
  document.getElementById('result').classList.remove('hidden');
  final.innerText=score+' åˆ†';
  wrong.innerHTML=wrongs.length?wrongs.map(w=>`<li>âŒ ${w}</li>`).join(''):'<li>ğŸ‰ å…¨å°</li>';
}

/* ===== æ™‚é˜ ===== */
function draw(h,m){
  let c=clockCanvas,ctx=c.getContext('2d');
  ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,200,200);
  ctx.translate(100,100);
  ctx.beginPath(); ctx.arc(0,0,90,0,Math.PI*2); ctx.stroke();
  for(let i=1;i<=12;i++){
    let a=i*Math.PI/6;
    ctx.fillText(i,70*Math.sin(a),-70*Math.cos(a));
  }
  hand((h+m/60)*Math.PI/6,50,5);
  hand(m*Math.PI/30,80,3,'red');
  function hand(a,l,w,c='#000'){
    ctx.save(); ctx.rotate(a);
    ctx.lineWidth=w; ctx.strokeStyle=c;
    ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0,-l); ctx.stroke();
    ctx.restore();
  }
}
</script>
</body>
</html>
